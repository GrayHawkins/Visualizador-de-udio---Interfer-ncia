<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Interfer√™ncia - Simula√ß√£o Interativa</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #101010;
    color: white;
    margin: 0;
  }
  h1 {
    margin-top: 20px;
  }
  canvas {
    border: 2px solid white;
    background: black;
    margin-top: 20px;
  }
  button {
    padding: 10px 20px;
    margin: 10px;
    border: none;
    border-radius: 5px;
    background: #3498db;
    color: white;
    font-size: 16px;
    cursor: pointer;
  }
  button:hover {
    background: #2980b9;
  }
  .controls {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
  }
</style>
</head>
<body>
<h1>Fen√¥meno da Interfer√™ncia</h1>
<p>Clique em um tipo de interfer√™ncia e use o bot√£o de √°udio para ligar/desligar o som correspondente.</p>
<div class="controls">
  <button onclick="selecionarTipo('construtiva')">Interfer√™ncia Construtiva</button>
  <button onclick="selecionarTipo('destrutiva')">Interfer√™ncia Destrutiva</button>
  <button onclick="selecionarTipo('batimentos')">Batimentos</button>
  <button onclick="toggleAudio()">üîä Ligar/Desligar √Åudio</button>
</div>
<canvas id="canvas" width="800" height="400"></canvas>
<audio id="audio" preload="auto"></audio>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let tipo = 'construtiva';
let t = 0;
const audio = document.getElementById('audio');
let audioAtivo = false;

const audios = {
  construtiva: 'audios/perspectiva_construtiva.wav',
  destrutiva: 'audios/perspectiva_destrutiva.wav',
  batimentos: 'audios/som_normal.wav'
};

// Configura o √°udio inicialmente
audio.src = audios[tipo];

// Cria AudioContext e conecta s√≥ depois do usu√°rio interagir
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let source;

function conectarAudio() {
  if (source) source.disconnect();
  source = audioCtx.createMediaElementSource(audio);
  source.connect(audioCtx.destination);
}

// Desenha ondas simples, com amplitude fixa
function onda(x, amplitude, comprimento, fase) {
  return amplitude * Math.sin((2 * Math.PI / comprimento) * x + fase);
}

function desenhar() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  let amplitudeBase = 50;

  ctx.strokeStyle = 'cyan';
  ctx.beginPath();
  for (let x = 0; x < canvas.width; x++) {
    let y = onda(x, amplitudeBase, 100, 0.02 * t);
    ctx.lineTo(x, canvas.height / 2 - y);
  }
  ctx.stroke();

  ctx.strokeStyle = 'magenta';
  ctx.beginPath();
  for (let x = 0; x < canvas.width; x++) {
    let fase2 = tipo === 'destrutiva' ? Math.PI : 0;
    let y;
    if (tipo === 'batimentos') {
      y = onda(x, amplitudeBase, 100, 0.02 * t) + onda(x, amplitudeBase, 105, 0.02 * t);
    } else {
      y = onda(x, amplitudeBase, 100, 0.02 * t + fase2);
    }
    ctx.lineTo(x, canvas.height / 2 - y);
  }
  ctx.stroke();

  ctx.strokeStyle = 'yellow';
  ctx.beginPath();
  for (let x = 0; x < canvas.width; x++) {
    let y1 = onda(x, amplitudeBase, 100, 0.02 * t);
    let fase2 = tipo === 'destrutiva' ? Math.PI : 0;
    let y2 = tipo === 'batimentos' ? onda(x, amplitudeBase, 100, 0.02 * t) + onda(x, amplitudeBase, 105, 0.02 * t) : onda(x, amplitudeBase, 100, 0.02 * t + fase2);
    let y = (y1 + y2) / 2;
    ctx.lineTo(x, canvas.height / 2 - y);
  }
  ctx.stroke();

  t++;
  requestAnimationFrame(desenhar);
}

desenhar();

function selecionarTipo(tipoEscolhido) {
  tipo = tipoEscolhido;
  audio.src = audios[tipo];
  if (audioAtivo) {
    // Ativa AudioContext e toca o √°udio
    audioCtx.resume().then(() => {
      conectarAudio();
      audio.play().catch(e => console.log("Erro ao tocar √°udio:", e));
    });
  }
}

function toggleAudio() {
  if (!audioAtivo) {
    // Ativa AudioContext e conecta fonte
    audioCtx.resume().then(() => {
      conectarAudio();
      audio.play().then(() => {
        audioAtivo = true;
        console.log("√Åudio iniciado");
      }).catch(e => {
        console.log("Erro ao iniciar √°udio:", e);
      });
    });
  } else {
    audio.pause();
    audioAtivo = false;
    console.log("√Åudio pausado");
  }
}
</script>
</body>
</html>
